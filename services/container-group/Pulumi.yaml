name: container-group
runtime: yaml
description: Pulumi-managed container group service that consumes centralized env outputs.

config:
  envStackRef:
    type: string
  name:
    type: string
  image:
    type: string
  port:
    type: integer
  cpuCores:
    type: number
  memoryInGb:
    type: number
  restartPolicy:
    type: string
    default: Always
  zone:
    type: string
    default: ""
  tags:
    type: object
    default:
      env: ${pulumi.stack}
      app: container-group

variables:
  containerTemplate:
    fn::fromJSON:
      fn::file: "../../azure-infra/containerGroup.json"

resources:
  env:
    type: pulumi:pulumi:StackReference
    properties:
      name: ${envStackRef}
  containerGroupArmDeployment:
    type: azure-native:resources:Deployment
    properties:
      resourceGroupName: ${env.outputs.resourceGroupName}
      properties:
        mode: Incremental
        template: ${containerTemplate}
        parameters:
          name:
            value: ${name}
          location:
            value: ${env.outputs.location}
          image:
            value: ${image}
          port:
            value: ${port}
          cpuCores:
            value: ${cpuCores}
          memoryInGb:
            value: ${memoryInGb}
          restartPolicy:
            value: ${restartPolicy}
          zone:
            value: ${zone}
          tags:
            value: ${tags}

outputs:
  resourceGroupName: ${env.outputs.resourceGroupName}
  containerGroupName: ${containerGroupArmDeployment.properties.outputs.containerGroupName.value}
  containerGroupId: ${containerGroupArmDeployment.properties.outputs.containerGroupId.value}
  fqdn: ${containerGroupArmDeployment.properties.outputs.fqdn.value}
